<!DOCTYPE html>
<html lang="id" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Cuaca</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: {
                        sunset: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            200: '#fed7aa',
                            500: '#ea580c',
                            600: '#c2410c',
                        },
                        midnight: {
                            50: '#f0f9ff',
                            800: '#1e40af',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>

    <style>
        .loader {
            border: 3px solid #e5e7eb;
            border-top: 3px solid #ea580c;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        body, div, button, input, i, p, h1, h2, h3 { transition: all 0.3s ease; }
    </style>
</head>

<body class="bg-sunset-50 dark:bg-midnight-950 min-h-screen text-midnight-900 dark:text-gray-100 p-4 md:p-8 font-sans">

    <div class="max-w-6xl mx-auto">
        
        <header class="flex flex-col md:flex-row justify-between items-center gap-4 mb-8">
            
            <div class="bg-white dark:bg-midnight-900 px-6 py-3 rounded-full shadow-md border-2 border-white/50 dark:border-white/10">
                <h1 class="text-xl font-bold tracking-tight text-midnight-900 dark:text-white">Dashboard Cuaca</h1>
            </div>

            <div class="relative w-full md:w-96 group z-50">
                <div class="flex items-center bg-white dark:bg-midnight-900 rounded-2xl px-4 py-3 shadow-md border-2 border-white/50 dark:border-white/10 focus-within:border-sunset-500 focus-within:ring-2 focus-within:ring-sunset-500/20 transition-all">
                    <i class="fa-solid fa-search text-gray-400 dark:text-gray-500 mr-3"></i>
                    <input type="text" id="cityInput" placeholder="Cari kota..." 
                           class="bg-transparent border-none outline-none w-full placeholder-gray-400 dark:placeholder-gray-500 text-sm font-medium text-midnight-900 dark:text-gray-200"
                           autocomplete="off">
                    <div id="searchLoader" class="loader hidden"></div>
                </div>
                <ul id="suggestions" class="absolute top-full left-0 w-full bg-white dark:bg-midnight-900 mt-2 rounded-xl shadow-xl overflow-hidden hidden border border-sunset-100 dark:border-white/10"></ul>
            </div>

            <div class="flex items-center gap-2 bg-white dark:bg-midnight-900 p-1.5 rounded-full shadow-md border-2 border-white/50 dark:border-white/10">
                <button onclick="toggleUnit()" id="unitBtn" class="w-9 h-9 rounded-full hover:bg-sunset-50 dark:hover:bg-midnight-950 text-xs font-bold text-gray-500 dark:text-gray-400 transition">°C</button>
                <div class="w-px h-4 bg-gray-300 dark:bg-gray-700"></div>
                <button onclick="toggleTheme()" class="w-9 h-9 rounded-full hover:bg-sunset-50 dark:hover:bg-midnight-950 text-gray-500 dark:text-sunset-500 transition"><i id="themeIcon" class="fa-solid fa-moon text-xs"></i></button>
                <button onclick="manualRefresh()" class="w-9 h-9 rounded-full hover:bg-sunset-50 dark:hover:bg-midnight-950 text-sunset-600 dark:text-sunset-500 transition" title="Refresh"><i class="fa-solid fa-arrows-rotate text-xs"></i></button>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-8 space-y-6">
                
                <div class="bg-white dark:bg-midnight-900 rounded-[2rem] p-8 shadow-lg border-2 border-white/50 dark:border-white/10 relative overflow-hidden">
                    
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center relative z-10">
                        <div>
                            <div class="flex items-center gap-3 mb-2">
                                <span class="bg-sunset-600 dark:bg-sunset-500 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider shadow-sm">Sekarang</span>
                                <p id="currentDate" class="text-xs font-bold text-gray-400 uppercase tracking-wide">SENIN, 1 JAN</p>
                            </div>
                            <h2 id="cityName" class="text-4xl md:text-5xl font-extrabold text-midnight-900 dark:text-white mb-1">Jakarta</h2>
                            <p id="weatherDesc" class="text-lg text-sunset-600 dark:text-sunset-400 capitalize font-bold">Cerah</p>
                        </div>
                        
                        <button onclick="toggleFavorite()" id="favBtn" class="mt-4 md:mt-0 w-12 h-12 rounded-full border-2 border-gray-100 dark:border-white/10 flex items-center justify-center text-gray-300 hover:text-red-500 hover:border-red-100 transition bg-gray-50 dark:bg-midnight-950 shadow-sm">
                            <i class="fa-regular fa-heart text-lg"></i>
                        </button>
                    </div>

                    <div class="flex flex-col md:flex-row items-center justify-between mt-8 gap-8 relative z-10">
                        <div class="flex items-center gap-4">
                            <div class="bg-sunset-50 dark:bg-midnight-950 p-4 rounded-2xl border border-sunset-100 dark:border-white/5">
                                <img id="weatherIcon" src="" alt="icon" class="w-16 h-16 drop-shadow-sm">
                            </div>
                            <div class="text-7xl font-extrabold text-midnight-900 dark:text-white tracking-tighter" id="temp">--°</div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 w-full md:w-auto">
                            <div class="bg-gray-50 dark:bg-midnight-950 p-4 rounded-2xl border border-gray-100 dark:border-white/5 min-w-[140px]">
                                <div class="flex items-center gap-2 mb-1">
                                    <i class="fa-solid fa-water text-sunset-500 text-xs"></i>
                                    <span class="text-xs text-gray-400 uppercase font-bold tracking-wider">Kelembapan</span>
                                </div>
                                <p id="humidity" class="text-xl font-bold text-midnight-900 dark:text-gray-200">--%</p>
                            </div>
                            <div class="bg-gray-50 dark:bg-midnight-950 p-4 rounded-2xl border border-gray-100 dark:border-white/5 min-w-[140px]">
                                <div class="flex items-center gap-2 mb-1">
                                    <i class="fa-solid fa-wind text-sunset-500 text-xs"></i>
                                    <span class="text-xs text-gray-400 uppercase font-bold tracking-wider">Angin</span>
                                </div>
                                <p id="windSpeed" class="text-xl font-bold text-midnight-900 dark:text-gray-200">-- km/h</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-4 ml-2">Prediksi 5 Hari</h3>
                    <div id="forecastContainer" class="grid grid-cols-2 md:grid-cols-5 gap-3">
                        <div class="bg-white dark:bg-midnight-900 p-4 rounded-xl shadow-sm border border-sunset-100 dark:border-white/10 h-32 animate-pulse"></div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-4 space-y-6">
                <div class="bg-white dark:bg-midnight-900 rounded-[2rem] p-6 shadow-lg border-2 border-white/50 dark:border-white/10 h-full flex flex-col">
                    <h3 class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-bookmark text-sunset-500"></i> Kota Disimpan
                    </h3>
                    
                    <div id="favoriteList" class="space-y-2 flex-1 overflow-y-auto max-h-[400px] custom-scrollbar pr-1">
                        <p class="text-sm text-gray-400 italic text-center py-10">Belum ada kota disimpan.</p>
                    </div>

                    <div class="mt-6 pt-4 border-t border-gray-100 dark:border-white/5 text-center">
                        <p class="text-xs text-gray-400">Terakhir update: <span id="lastUpdate" class="font-mono text-sunset-600 dark:text-sunset-400 font-bold">--:--</span></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const API_KEY = '283ce8346c4a0d2df78ae93fedf544b1';
        const BASE_URL = 'https://api.openweathermap.org/data/2.5';
        
        let currentCity = 'Bandar Lampung'; 
        let units = 'metric'; 
        let updateInterval;
        let favoriteCities = JSON.parse(localStorage.getItem('favCities')) || [];

        const cityInput = document.getElementById('cityInput');
        const suggestionsBox = document.getElementById('suggestions');
        const themeIcon = document.getElementById('themeIcon');

        window.addEventListener('load', () => {
            loadTheme();
            getWeather(currentCity);
            renderFavorites();
            updateInterval = setInterval(() => getWeather(currentCity), 300000);
        });

        function toggleTheme() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                themeIcon.className = 'fa-solid fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                themeIcon.className = 'fa-solid fa-sun text-yellow-400';
                localStorage.setItem('theme', 'dark');
            }
        }

        function loadTheme() {
            if (localStorage.getItem('theme') === 'dark') toggleTheme();
        }

        function toggleUnit() {
            units = units === 'metric' ? 'imperial' : 'metric';
            document.getElementById('unitBtn').innerText = units === 'metric' ? '°C' : '°F';
            getWeather(currentCity);
        }

        function manualRefresh() { getWeather(currentCity); }

        async function getWeather(city) {
            try {
                document.getElementById('cityName').classList.add('opacity-50');
                
                const currentRes = await fetch(`${BASE_URL}/weather?q=${city}&units=${units}&appid=${API_KEY}&lang=id`);
                if (!currentRes.ok) throw new Error('Kota tidak ditemukan');
                const currentData = await currentRes.json();

                const { lat, lon } = currentData.coord;
                const forecastRes = await fetch(`${BASE_URL}/forecast?lat=${lat}&lon=${lon}&units=${units}&appid=${API_KEY}&lang=id`);
                const forecastData = await forecastRes.json();

                renderCurrentWeather(currentData);
                renderForecast(forecastData);
                
                currentCity = currentData.name;
                updateFavoriteBtnState();
                document.getElementById('cityName').classList.remove('opacity-50');

            } catch (error) {
                console.error(error);
                document.getElementById('cityName').innerText = "Not Found";
                document.getElementById('cityName').classList.remove('opacity-50');
            }
        }

        function renderCurrentWeather(data) {
            document.getElementById('cityName').innerText = data.name;
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('currentDate').innerText = new Date().toLocaleDateString('id-ID', options);
            document.getElementById('temp').innerText = Math.round(data.main.temp) + '°';
            document.getElementById('weatherDesc').innerText = data.weather[0].description;
            document.getElementById('humidity').innerText = data.main.humidity + '%';
            document.getElementById('windSpeed').innerText = Math.round(data.wind.speed) + (units === 'metric' ? ' km/h' : ' mph');
            document.getElementById('weatherIcon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
            const now = new Date();
            document.getElementById('lastUpdate').innerText = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
        }

        function renderForecast(data) {
            const container = document.getElementById('forecastContainer');
            container.innerHTML = '';
            
            const dailyData = {};
            
            data.list.forEach(item => {
                const date = item.dt_txt.split(' ')[0];
                const today = new Date().toISOString().split('T')[0];
                if (date === today) return;

                if (!dailyData[date]) {
                    dailyData[date] = {
                        min: item.main.temp_min,
                        max: item.main.temp_max,
                        icon: item.weather[0].icon,
                        desc: item.weather[0].description,
                        dt: item.dt
                    };
                } else {
                    dailyData[date].min = Math.min(dailyData[date].min, item.main.temp_min);
                    dailyData[date].max = Math.max(dailyData[date].max, item.main.temp_max);
                }
            });

            const dates = Object.keys(dailyData).slice(0, 5);

            dates.forEach(date => {
                const day = dailyData[date];
                const dateObj = new Date(day.dt * 1000);
                const dayName = dateObj.toLocaleDateString('id-ID', { weekday: 'short' });
                
                const el = document.createElement('div');
                el.className = "bg-white dark:bg-midnight-900 p-3 rounded-xl shadow-md border-b-4 border-sunset-200 dark:border-white/10 flex flex-col items-center justify-center hover:-translate-y-1 transition group cursor-default";
                el.innerHTML = `
                    <p class="text-xs font-bold text-gray-400 group-hover:text-sunset-500 transition uppercase">${dayName}</p>
                    <img src="https://openweathermap.org/img/wn/${day.icon}.png" class="w-10 h-10 my-1">
                    <div class="flex gap-2 text-sm">
                        <span class="font-bold text-midnight-900 dark:text-white">${Math.round(day.max)}°</span>
                        <span class="font-medium text-gray-400 dark:text-gray-500">${Math.round(day.min)}°</span>
                    </div>
                    <p class="text-[10px] text-gray-400 truncate w-full text-center mt-1 capitalize">${day.desc}</p>
                `;
                container.appendChild(el);
            });
        }

        let timer;
        cityInput.addEventListener('input', function() {
            const query = this.value;
            suggestionsBox.innerHTML = '';
            suggestionsBox.classList.add('hidden');
            if (query.length < 3) return;

            clearTimeout(timer);
            timer = setTimeout(async () => {
                document.getElementById('searchLoader').classList.remove('hidden');
                try {
                    const res = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${query}&limit=5&appid=${API_KEY}`);
                    const cities = await res.json();
                    
                    if (cities.length > 0) {
                        suggestionsBox.classList.remove('hidden');
                        cities.forEach(city => {
                            const li = document.createElement('li');
                            li.className = "px-4 py-3 hover:bg-sunset-50 dark:hover:bg-midnight-950 cursor-pointer text-sm border-b border-gray-100 dark:border-white/5 last:border-0 transition";
                            li.innerHTML = `<span class="font-bold text-midnight-900 dark:text-gray-200">${city.name}</span> <span class="text-xs text-gray-400 ml-1">${city.country}</span>`;
                            li.onclick = () => {
                                cityInput.value = city.name;
                                suggestionsBox.classList.add('hidden');
                                getWeather(city.name);
                            };
                            suggestionsBox.appendChild(li);
                        });
                    }
                } catch (e) { console.error(e); } 
                finally { document.getElementById('searchLoader').classList.add('hidden'); }
            }, 500);
        });

        document.addEventListener('click', (e) => {
            if (!cityInput.contains(e.target)) suggestionsBox.classList.add('hidden');
        });

        cityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                getWeather(cityInput.value);
                suggestionsBox.classList.add('hidden');
            }
        });

        function toggleFavorite() {
            const btn = document.getElementById('favBtn');
            const index = favoriteCities.indexOf(currentCity);
            if (index === -1) favoriteCities.push(currentCity);
            else favoriteCities.splice(index, 1);
            localStorage.setItem('favCities', JSON.stringify(favoriteCities));
            updateFavoriteBtnState();
            renderFavorites();
        }

        function updateFavoriteBtnState() {
            const btn = document.getElementById('favBtn');
            const icon = btn.querySelector('i');
            if (favoriteCities.includes(currentCity)) {
                icon.classList.remove('fa-regular'); icon.classList.add('fa-solid');
                btn.classList.add('text-red-500', 'border-red-200', 'dark:border-red-900');
                btn.classList.remove('text-gray-300', 'border-gray-100', 'dark:border-white/10');
            } else {
                icon.classList.add('fa-regular'); icon.classList.remove('fa-solid');
                btn.classList.remove('text-red-500', 'border-red-200', 'dark:border-red-900');
                btn.classList.add('text-gray-300', 'border-gray-100', 'dark:border-white/10');
            }
        }

        function renderFavorites() {
            const list = document.getElementById('favoriteList');
            list.innerHTML = '';
            if (favoriteCities.length === 0) {
                list.innerHTML = '<div class="flex flex-col items-center justify-center h-full text-gray-300 dark:text-gray-600 mt-10"><i class="fa-solid fa-wind text-4xl mb-2"></i><p class="text-xs">Belum ada kota.</p></div>';
                return;
            }
            favoriteCities.forEach(city => {
                const item = document.createElement('div');
                item.className = "group flex justify-between items-center bg-gray-50 dark:bg-midnight-950 p-3 rounded-xl border border-transparent hover:border-sunset-300 dark:hover:border-sunset-500 transition cursor-pointer";
                item.innerHTML = `
                    <div onclick="getWeather('${city}')" class="flex-1"><p class="font-bold text-midnight-900 dark:text-gray-200 text-sm">${city}</p></div>
                    <button onclick="removeFavorite('${city}')" class="text-gray-300 hover:text-red-400 transition p-1"><i class="fa-solid fa-xmark text-xs"></i></button>
                `;
                list.appendChild(item);
            });
        }

        function removeFavorite(city) {
            favoriteCities = favoriteCities.filter(c => c !== city);
            localStorage.setItem('favCities', JSON.stringify(favoriteCities));
            renderFavorites();
            if (currentCity === city) updateFavoriteBtnState();
        }
    </script>
</body>
</html>